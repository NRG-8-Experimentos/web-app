<div class="analytics-leader-screen two-column-layout">
  <div class="analytics-column">
    <!-- Resumen General -->
    <div class="section-card enhanced-section">
      <div class="section-title">
        <span class="material-icons">info</span>
        <span>Resumen General</span>
      </div>
      <div class="metrics-row">
        <div class="stat-card green" matTooltip="Tareas completadas">
          <div class="stat-value">{{ analytics.overview.completed ?? 0 }}</div>
          <div class="stat-label">Completadas</div>
        </div>
        <div class="stat-card teal" matTooltip="Tareas terminadas">
          <div class="stat-value">{{ analytics.overview.done ?? 0 }}</div>
          <div class="stat-label">Terminadas</div>
        </div>
        <div class="stat-card blue" matTooltip="Tareas en progreso">
          <div class="stat-value">{{ analytics.overview.inProgress ?? 0 }}</div>
          <div class="stat-label">En progreso</div>
        </div>
        <div class="stat-card orange" matTooltip="Tareas pendientes">
          <div class="stat-value">{{ analytics.overview.pending ?? 0 }}</div>
          <div class="stat-label">Pendientes</div>
        </div>
        <div class="stat-card red" matTooltip="Tareas atrasadas">
          <div class="stat-value">{{ analytics.overview.overdue ?? 0 }}</div>
          <div class="stat-label">Atrasadas</div>
        </div>
      </div>
      <hr class="section-divider">
      <div class="members-list">
        <span class="members-title">Todos los miembros:</span>
        <div *ngFor="let member of safeMembers" class="metric-row member-row">
          <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
          <span class="member-name">{{ member.name }} {{ member.surname }}</span>
        </div>
      </div>
    </div>

    <!-- Distribuci贸n de Tareas -->
    <div class="section-card enhanced-section">
      <div class="section-title">
        <span class="material-icons">account_circle</span>
        <span>Distribuci贸n de Tareas</span>
      </div>
      <div *ngIf="!analytics.leaderTasks.length" class="empty-section">
        <span>No disponible</span>
      </div>
      <div *ngIf="analytics.leaderTasks.length">
        <div class="bar-chart-row" *ngFor="let task of analytics.leaderTasks">
          <img *ngIf="task.imgUrl" [src]="task.imgUrl" class="profile-image">
          <span class="bar-chart-label">{{ task.memberName }}</span>
          <div class="bar-chart-bar-bg">
            <div
              class="bar-chart-bar-fg"
              [ngStyle]="{'width': ((task.taskCount || 1) * 100 / getMaxTaskCount(analytics.leaderTasks)) + '%'}"
            ></div>
          </div>
          <span class="bar-chart-value badge" style="white-space:nowrap;">
            {{ task.taskCount }} {{ task.taskCount === 1 ? 'tarea' : 'tareas' }}
          </span>
        </div>
      </div>
      <hr class="section-divider">
      <div class="members-list">
        <span class="members-title">Todos los miembros:</span>
        <div *ngFor="let member of safeMembers" class="metric-row member-row">
          <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
          <span class="member-name">{{ member.name }} {{ member.surname }}</span>
        </div>
      </div>
    </div>

    <!-- Tiempo Promedio de Finalizaci贸n -->
    <div class="section-card enhanced-section">
      <div class="section-title">
        <span class="material-icons">date_range</span>
        <span>Tiempo Promedio de Finalizaci贸n</span>
      </div>
      <div *ngIf="avgCompletionMembers.length > 0">
        <div *ngFor="let member of avgCompletionMembers" class="metric-row member-row">
          <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
          <span class="member-name">{{ member.name }} {{ member.surname }}</span>
          <span class="metric-value badge" style="margin-left:8px;">
            {{ formatMinutesToDuration(member.avgMinutes) }}
          </span>
        </div>
      </div>
      <div *ngIf="!avgCompletionMembers.length" class="empty-section">
        <span>No disponible</span>
      </div>
    </div>
  </div>

  <div class="analytics-column">
    <!-- Tareas Reprogramadas -->
    <div class="section-card enhanced-section">
      <div class="section-title">
        <span class="material-icons">build</span>
        <span>Tareas Reprogramadas</span>
      </div>
      <div class="metric-row">
        <span>Total reprogramadas</span>
        <span class="metric-value badge">{{ analytics.rescheduled?.rescheduled ?? 0 }}</span>
      </div>
      <hr class="section-divider">
      <div class="members-list">
        <span class="members-title">Miembros con tareas reprogramadas:</span>
        <div *ngIf="membersWithRescheduled.length > 0">
          <div class="bar-chart-row" *ngFor="let member of membersWithRescheduled">
            <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
            <span class="bar-chart-label">{{ member.name }} {{ member.surname }}</span>
            <div class="bar-chart-bar-bg">
              <div
                class="bar-chart-bar-fg"
                [ngStyle]="{'width': ((member.rescheduledCount || 1) * 100 / getMaxTaskCount(membersWithRescheduled)) + '%'}"
              ></div>
            </div>
            <span class="bar-chart-value badge" style="white-space:nowrap;">
              {{ member.rescheduledCount }} {{ member.rescheduledCount === 1 ? 'tarea' : 'tareas' }}
            </span>
          </div>
        </div>
        <div *ngIf="!membersWithRescheduled.length" class="empty-section">
          <span>No disponible</span>
        </div>
      </div>
    </div>

    <!-- Tiempo pasado en tareas completadas -->
    <div class="section-card enhanced-section">
      <div class="section-title">
        <span class="material-icons">hourglass_bottom</span>
        <span>Tiempo pasado en tareas completadas</span>
      </div>
      <div class="metric-row">
        <span class="material-icons">timer</span>
        <span class="metric-value badge">
          {{ formatMinutesToDuration(analytics.timePassed?.timePassed) }}
        </span>
      </div>
    </div>
  </div>
</div>
